---
title: "把你的服务藏进堡垒：Cloudflare Zero Trust 全流程配置指南"
date: "2025-12-05"
description: "记录一下我是如何使用 Cloudflare Zero Trust 把我的私有服务用安全的登录页面保护起来的，顺便把配置全流程分享出来，帮助大家告别自己的服务管理页被暴力破解的焦虑。"
---

你是否厌倦了把原本私有的管理后台直接暴露在公网 IP 上？或者你正在寻找一种比传统 VPN 更轻量、比账户密码(Basic Auth)更现代化的方式来保护你的个人网页？

Cloudflare Zero Trust (Access) 就是你需要的答案。它能在你的 Web 服务前架设一道带有现代身份验证（SSO）的“防盗门”，只有通过验证的请求才能触达你的服务器。

> ### 写在前面
> 
> 在开始之前，请确认以下两点：  
> 1.  **我们默认你已经拥有一个 Cloudflare 账号，且有一个已经上线、需要被保护的页面**（无论它是跑在 VPS 上的 Docker 容器，还是 Cloudflare Pages 项目）。  
> 2.  **关于费用**：Cloudflare Zero Trust 拥有非常慷慨的 **免费套餐**（支持 50 个用户），完全能够满足个人或小团队需求。**但是，首次开通时系统可能要求绑定支付方式（支持 PayPal 或信用卡）才可以开始使用**。请放心，只要你不超出免费额度，是不会扣费的。

---

## 第一步：初始化 Zero Trust 面板

1.  登录你的 Cloudflare 仪表盘。
2.  在左侧侧边栏找到 **Zero Trust** 图标，点击进入。
3.  如果你是第一次进入，系统会引导你创建一个 **Team Domain**（团队域名）。
    * 例如我起的名字是 `yewyard.cloudflareaccess.com` 。
    * *提示：起一个好记的名字，以后你登录验证时会看到它。*
4.  **选择套餐**：在进入之后它可能会提醒你选择套餐。对于一般学生开发者，选择 **Free Plan** 即可，他有非常慷慨的额度，足够我们使用，但是会要求绑定支付方式，你可以选择 PayPal 进行绑定（这通常是学生党最方便的方案）。完成绑定后，你便拥有了一个功能强大的企业级安全后台。

---

## 第二步：配置身份认证源 (IdP)

默认情况下，Cloudflare 提供“One-time PIN”（邮件验证码）方式。但如果你想用 **GitHub** / **Google** 账号登录也是OK的，具体流程我们在[下一篇文章](./github-login-in-zero-trust)讨论。

---

## 第三步：创建应用保护 (Protect an Application)

这是最核心的一步。我们要把你那个“裸奔”的页面保护起来。

> 此处，我们以保护一个托管在 `admin.yewyard.cn` 的私有管理后台为例。  
> *注意：这个域名必须是由 Cloudflare 托管 DNS 的。*

1.  回到 Zero Trust 面板首页，点击左侧的 **Access** -> **Applications**。
2.  点击 **Add an application**。
3.  选择 **Self-hosted**（自托管）。
4.  **配置应用详情**：
    * **Application name**: 给你的服务起个名，比如 `My Dashboard`。
    * **Session Duration**: 登录状态保持多久？个人使用建议选长一点，比如 `1 Month`，这样你就不用天天登录了。
    * **Application domain**: 这里填写你想要保护的域名。
        * Subdomain: `admin` 
        * Domain: `yewyard.cn` 
    > 实际上，子域名和路径是可选的，你也可以保护你的整个主域名（例如 `yewyard.cn`）  
    > 不仅如此，它还可以添加多个域名和路径进行保护，实现 SSO (单点登录)。
5.  点击 **Next**。

---

## 第四步：制定访问策略 (Policies)

这步决定了“谁”可以通过这扇门。  
**请务必设置正确的白名单，否则这个登陆界面就只是一个空壳！随便一个邮箱都可以登录**

1.  **Policy name**: 随便填，比如 `Allow Me : Email`。
2.  **Action**: 选择 **Allow**。
3.  **Configure rules** (关键步骤)：
    * 这是设置“白名单”的地方。
    * **Selector**: 选择 **Emails**。
    * **Value**: 输入你的个人邮箱地址。
4.  点击 **Next**。

---

## 第五步：设置登录页外观 (可选)

在这个页面，你可以自定义拦截页面的样子
> 我比较懒，直接用默认的了，你们可以自行探索

点击 **Add application** 完成保存。

---

## 第六步：让我们看看它的强大效果

现在，打开浏览器，重新访问你刚才设置了保护的域名（例如 `admin.yewyard.cn`）。

**你应当看到：**
不再是直接进入页面，而是跳转到一个 Cloudflare 的登录页。

然后就像一个高级且安全的网站一样，输入邮箱，接收验证码后才可进入，完美。
> 另外，我个人建议你测试一下其他邮箱是否被正常拒绝访问，在策略里排除一个你的邮箱，用这个邮箱登录，配置正确的话你应该会在登录后回到这个页面，并吃到一个拒绝访问的提示。

**安全原理：**
Cloudflare 在边缘网络拦截了所有请求。只有当你通过身份验证后，Cloudflare 才会发放一个加密的 Token（JWT），并允许请求通过到达你的源服务器。

---

### 总结

配置完成后，你的私有服务就拥有了 Google/Facebook 级别的安全网关。再也不用担心端口扫描和暴力破解，同时还能享受到单点登录（SSO）的便捷。

现在，尽情享受你的 Zero Trust 之旅吧！

***

### 下一步建议
如果你觉得次次都要接码验证超级麻烦，非常好，我和你想到一块去了，对于这个问题，我们可以配置 **GitHub 登录** 配合 **Passkeys 通行密钥**，具体步骤可以参考我的[下一篇文章](./github-login-in-zero-trust)。
